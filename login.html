<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep all your existing head content -->
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        /* Keep all your existing styles */
    </style>
</head>
<body>
    <!-- Keep all your existing HTML -->
    <!-- Make sure you have these elements in your HTML -->
    <form id="loginForm">
        <input id="login-username" type="text">
        <input id="login-password" type="password">
        <div id="loginError"></div>
    </form>
    
    <form id="signupForm">
        <input id="signup-username" type="text">
        <input id="signup-email" type="email">
        <input id="signup-password" type="password">
        <div id="signupError"></div>
        <div id="signupSuccess"></div>
    </form>

    <script>
        // Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Get form elements
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const loginError = document.getElementById('loginError');
        const signupError = document.getElementById('signupError');
        const signupSuccess = document.getElementById('signupSuccess');

        // Modified login function
        loginForm.onsubmit = function(e) {
            e.preventDefault();
            loginError.textContent = '';
            const email = document.getElementById('login-username').value + "@yourdomain.com"; // Or use email directly
            const password = document.getElementById('login-password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in
                    const user = userCredential.user;
                    localStorage.setItem('currentUser', JSON.stringify({
                        uid: user.uid,
                        email: user.email,
                        isAuthenticated: true
                    }));
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    loginError.textContent = error.message;
                });
        };

        // Modified signup function
        signupForm.onsubmit = function(e) {
            e.preventDefault();
            signupError.textContent = '';
            signupSuccess.textContent = '';
            
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            // Validation
            if (username.length < 4) {
                signupError.textContent = 'Username must be at least 4 characters.';
                return;
            }
            
            if (password.length < 6) {
                signupError.textContent = 'Password must be at least 6 characters.';
                return;
            }
            
            if (!email.endsWith('@gmail.com')) {
                signupError.textContent = 'Please use a Gmail address to register.';
                return;
            }
            
            // Create user with Firebase Auth
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // User created
                    const user = userCredential.user;
                    
                    // Save additional user data to Firestore
                    return db.collection('users').doc(user.uid).set({
                        username: username,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    signupSuccess.textContent = 'Registration successful! You can now login.';
                    document.getElementById('signup-username').value = '';
                    document.getElementById('signup-email').value = '';
                    document.getElementById('signup-password').value = '';
                    
                    setTimeout(() => {
                        // Assuming you have a showLogin function
                        if (typeof showLogin === 'function') {
                            showLogin();
                        }
                    }, 2000);
                })
                .catch((error) => {
                    signupError.textContent = error.message;
                });
        };

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                localStorage.setItem('currentUser', JSON.stringify({
                    uid: user.uid,
                    email: user.email,
                    isAuthenticated: true
                }));
                window.location.href = 'index.html';
            }
        });

        // Initial auth check
        if (JSON.parse(localStorage.getItem('currentUser'))) {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
